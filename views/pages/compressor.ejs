<div class="glass-card" style="max-width: 600px; margin: 0 auto;">
    <h1 style="margin-bottom: 2rem; text-align: center;">Image Compressor</h1>

    <div class="form-group">
        <label>Select Image</label>
        <input type="file" id="comp-file" accept="image/*">
    </div>

    <div class="form-group">
        <label>Target Size (KB)</label>
        <input type="number" id="comp-size" value="100" min="10">
    </div>

    <button class="primary-btn" onclick="compressImage()">Compress</button>

    <div id="result" class="result-area" style="display: none;">
        <p style="margin-bottom: 1rem;">Compression Complete!</p>
        <a id="download-link" href="#" class="primary-btn"
            style="text-decoration: none; display: inline-block;">Download Image</a>
    </div>
</div>

<script>
    async function compressImage() {
        const fileInput = document.getElementById('comp-file');
        const sizeInput = document.getElementById('comp-size');
        const resultDiv = document.getElementById('result');

        if (fileInput.files.length === 0) return alert('Select an image');

        const formData = new FormData();
        formData.append('image', fileInput.files[0]);
        formData.append('size_kb', sizeInput.value);

        try {
            const res = await fetch('/api/compress-image', { method: 'POST', body: formData });
            if (!res.ok) throw new Error('Compression failed');

            const blob = await res.blob();
            const url = URL.createObjectURL(blob);

            const link = document.getElementById('download-link');
            link.href = url;
            link.download = `compressed-${Date.now()}.jpg`;

            resultDiv.style.display = 'block';
        } catch (e) {
            alert(e.message);
        }
    }
</script>