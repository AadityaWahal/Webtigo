<div class="glass-card" style="max-width: 800px; margin: 0 auto;">
    <h1 style="text-align: center; margin-bottom: 2rem;">Images to PDF</h1>

    <div class="drop-zone" id="drop-zone"
        style="border: 2px dashed rgba(255,255,255,0.2); padding: 3rem; text-align: center; border-radius: 1rem; cursor: pointer; transition: all 0.3s ease;">
        <p style="margin-bottom: 1rem; font-size: 1.2rem;">Drag & Drop images here or Click to Browse</p>
        <span style="font-size: 0.9rem; opacity: 0.7;">Supports JPG, PNG</span>
        <input type="file" id="file-input" multiple accept="image/png, image/jpeg, image/jpg" style="display: none;">
    </div>

    <div id="file-list-container" style="margin-top: 2rem;">
        <ul id="file-list" style="list-style: none; padding: 0;">
            <!-- File items will be added here -->
        </ul>
    </div>

    <div style="text-align: center; margin-top: 2rem;">
        <button class="primary-btn" onclick="convertToPdf()" id="convert-btn" disabled
            style="opacity: 0.5; cursor: not-allowed;">Convert to PDF</button>
    </div>
</div>

<style>
    .file-item {
        background: rgba(255, 255, 255, 0.05);
        margin-bottom: 0.5rem;
        padding: 0.8rem;
        border-radius: 0.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .file-info {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .file-name {
        font-size: 0.9rem;
    }

    .file-actions button {
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        font-size: 1.2rem;
        padding: 0 0.5rem;
        opacity: 0.7;
        transition: opacity 0.2s;
    }

    .file-actions button:hover {
        opacity: 1;
        color: var(--accent-color, #4facfe);
    }

    .drop-zone:hover,
    .drop-zone.dragover {
        border-color: var(--accent-color, #4facfe);
        background: rgba(255, 255, 255, 0.05);
    }
</style>

<script>
    let selectedFiles = [];
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('file-input');
    const fileList = document.getElementById('file-list');
    const convertBtn = document.getElementById('convert-btn');

    // Drag & Drop Handlers
    dropZone.addEventListener('click', () => fileInput.click());

    dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.classList.add('dragover');
    });

    dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));

    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.classList.remove('dragover');
        handleFiles(e.dataTransfer.files);
    });

    fileInput.addEventListener('change', (e) => handleFiles(e.target.files));

    function handleFiles(files) {
        const validFiles = Array.from(files).filter(f => f.type.startsWith('image/'));
        if (validFiles.length === 0) return;

        selectedFiles = [...selectedFiles, ...validFiles];
        renderFileList();
    }

    function renderFileList() {
        fileList.innerHTML = '';
        selectedFiles.forEach((file, index) => {
            const li = document.createElement('li');
            li.className = 'file-item';
            li.innerHTML = `
                <div class="file-info">
                   <span style="font-weight: bold; opacity: 0.5;">${index + 1}.</span>
                   <span class="file-name">${file.name}</span>
                </div>
                <div class="file-actions">
                    <button onclick="moveFile(${index}, -1)" title="Move Up">↑</button>
                    <button onclick="moveFile(${index}, 1)" title="Move Down">↓</button>
                    <button onclick="removeFile(${index})" title="Remove" style="color: #ff6b6b;">×</button>
                </div>
            `;
            fileList.appendChild(li);
        });

        updateButtonState();
    }

    window.moveFile = (index, direction) => {
        const newIndex = index + direction;
        if (newIndex < 0 || newIndex >= selectedFiles.length) return;

        [selectedFiles[index], selectedFiles[newIndex]] = [selectedFiles[newIndex], selectedFiles[index]];
        renderFileList();
    };

    window.removeFile = (index) => {
        selectedFiles.splice(index, 1);
        renderFileList();
    };

    function updateButtonState() {
        if (selectedFiles.length > 0) {
            convertBtn.disabled = false;
            convertBtn.style.opacity = '1';
            convertBtn.style.cursor = 'pointer';
        } else {
            convertBtn.disabled = true;
            convertBtn.style.opacity = '0.5';
            convertBtn.style.cursor = 'not-allowed';
        }
    }

    window.convertToPdf = async () => {
        if (selectedFiles.length === 0) return;

        const originalText = convertBtn.innerText;
        convertBtn.innerText = 'Converting...';
        convertBtn.disabled = true;

        const formData = new FormData();
        selectedFiles.forEach(file => formData.append('images', file));

        try {
            const res = await fetch('/api/images-to-pdf', {
                method: 'POST',
                body: formData
            });

            if (!res.ok) throw new Error('Conversion failed');

            const blob = await res.blob();
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `webtigo-images-${Date.now()}.pdf`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);

        } catch (err) {
            alert('Error converting images: ' + err.message);
        } finally {
            convertBtn.innerText = originalText;
            convertBtn.disabled = false;
        }
    };
</script>